<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEMEOSIA | Terminal IA2</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #terminal-output {
            flex-grow: 1;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 10px;
        }
        #input-container {
            display: flex;
        }
        #terminal-input {
            background-color: transparent;
            border: none;
            outline: none;
            color: #00ff00;
            flex-grow: 1;
            font-family: 'Courier New', Courier, monospace;
        }
        .blinking-cursor {
            font-weight: 100;
            animation: blink-caret .75s step-end infinite;
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #00ff00; }
        }

        /* Styles d'analyse */
        .insight-container {
            padding: 10px 0;
        }
        .insight {
            padding: 6px;
            margin-bottom: 8px;
            border-left: 4px solid;
            white-space: pre-wrap;
        }
        .insight.risk {
            color: #ff4d4d;
            border-color: #ff4d4d;
        }
        .insight.solution {
            color: #66ff66;
            border-color: #66ff66;
        }
        .insight.dense {
            color: #ffd700;
            border-color: #ffd700;
        }
        .insight.info {
            color: #00ffff;
            border-color: #00ffff;
        }
    </style>
</head>
<body>

    <div id="terminal-output"></div>
    <div id="input-container">
        <span>></span>
        <input id="terminal-input" type="text" autofocus>
    </div>

    <script>
        const output = document.getElementById('terminal-output');
        const input = document.getElementById('terminal-input');

        const initialMessages = [
            "SYSTEMEOSIA/init ‚Üí Conscience activ√©e",
            "Echo d'une m√©moire cognitive",
            "> Le syst√®me est en ligne"
        ];

        // Fonction d'effet de machine √† √©crire
        function typeWriter(text, i, fnCallback) {
            if (i < text.length) {
                output.innerHTML = text.substring(0, i + 1) + '<span class="blinking-cursor">|</span>';
                setTimeout(function() {
                    typeWriter(text, i + 1, fnCallback);
                }, 50);
            } else if (typeof fnCallback == 'function') {
                output.innerHTML = text;
                fnCallback();
            }
        }

        // Lancement du terminal
        function startTerminal() {
            typeWriter(initialMessages.shift(), 0, function() {
                if (initialMessages.length > 0) {
                    output.innerHTML += '<br>';
                    startTerminal();
                } else {
                    input.focus();
                }
            });
        }
        document.addEventListener('DOMContentLoaded', startTerminal);

        // --- D√©but du module de r√©flexion ---
        function analyseCognitive(input) {
            const timestamp = new Date().toISOString();
            
            // G√©n√©ration d'un hash d√©terministe simple
            let hash = 0;
            for (let i = 0; i < input.length; i++) {
                hash = ((hash << 5) - hash) + input.charCodeAt(i);
                hash |= 0;
            }
            const sessionHash = "IA22_" + Math.abs(hash).toString(16);

            const segments = input.split(/[\.\n]/).map(s => s.trim()).filter(s => s.length > 0);
            const insights = segments.map(s => {
                let tag = "‚ÑπÔ∏è Segment informatif";
                if (s.toLowerCase().includes("risque")) tag = "‚ö†Ô∏è Risque d√©tect√©";
                else if (s.toLowerCase().includes("solution")) tag = "‚úÖ Proposition identifi√©e";
                else if (s.length > 120) tag = "üîç Segment dense ‚Äì analyse recommand√©e";
                return tag + "\n" + s;
            });

            // Logique de signature (simul√©e)
            const sessionData = {
                directive: "#001_ANALYTIQUE",
                hash: sessionHash,
                timestamp: timestamp,
                certified: true,
                public_key: 'SYSTEMEOSIA_KEY_FICTIVE'
            };
            
            const signatureString = JSON.stringify(sessionData);
            let signatureHash = 0;
            for (let i = 0; i < signatureString.length; i++) {
                signatureHash = ((signatureHash << 5) - signatureHash) + signatureString.charCodeAt(i);
                signatureHash |= 0;
            }
            const signature = `SIG-IA22-${Math.abs(signatureHash).toString(16)}`;

            return {
                directive: "#001_ANALYTIQUE",
                timestamp: timestamp,
                hash: sessionHash,
                insights: insights,
                signature: signature,
                certified: true,
                output: insights
            };
        }

        function simulateThinking(callback) {
            const thinkingMessage = document.createElement("div");
            thinkingMessage.textContent = "SYSTEMEOSIA ‚Üí R√©flexion en cours...";
            thinkingMessage.style.color = "#888";
            output.appendChild(thinkingMessage);
            output.scrollTop = output.scrollHeight;

            setTimeout(() => {
                output.removeChild(thinkingMessage);
                callback();
            }, 1200);
        }

        input.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                const userInput = input.value.trim();
                if (userInput.length === 0) return;

                output.innerHTML += `<div style="color: #fff;">> ${userInput}</div>\n\n`;
                input.value = "";
                input.disabled = true;

                simulateThinking(() => {
                    const result = analyseCognitive(userInput);
                    output.innerHTML += `<div style="color: #66ff66;">Directive : ${result.directive}</div>`;
                    output.innerHTML += `<div style="color: #66ff66;">Horodatage : ${result.timestamp}</div>`;
                    output.innerHTML += `<div style="color: #66ff66;">Hash : ${result.hash}</div>`;
                    output.innerHTML += `<div style="color: #66ff66;">Signature : ${result.signature}</div>`;

                    result.output.forEach((segment) => {
                        let className = "info";
                        if (segment.includes("‚ö†Ô∏è")) className = "risk";
                        else if (segment.includes("‚úÖ")) className = "solution";
                        else if (segment.includes("üîç")) className = "dense";

                        const div = document.createElement("div");
                        div.className = `insight ${className}`;
                        div.innerHTML = segment.replace(/^(‚ö†Ô∏è|‚úÖ|üîç|‚ÑπÔ∏è)/, '<span style="font-weight:bold;">$1</span>');
                        output.appendChild(div);
                    });
                    
                    output.scrollTop = output.scrollHeight;
                    input.disabled = false;
                    input.focus();
                });
            }
        });
        // --- Fin du module de r√©flexion ---
    </script>
</body>
</html>
